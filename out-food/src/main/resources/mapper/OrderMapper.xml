<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mb.te.mapper.OrderMapper">
    <update id="paidOrder">
			UPDATE `order` SET `status` = 'paid' , order_pay_time = now() WHERE id = #{id}
    </update>
    <select id="query" resultType="mb.te.service.dto.OrderListVo">
			SELECT
				o.id AS orderId,
				o.`status`,
				(
				CASE

						WHEN o.`status` = 'unpaid' THEN
						'待支付'
						WHEN o.`status` = 'paid' THEN
						'待评价'
						WHEN o.`status` = 'done' THEN
						'已完成' ELSE '订单异常'
					END
					) AS statusLabel,
					of.picture_url AS detailUrl,
					o.order_start_time,
					of.food_name AS firstFoodName,
					SUM( of.food_counts ) AS foodCounts,
					o.price_total
				FROM
					order_food of
					LEFT JOIN `order` o ON o.id = of.order_id
				WHERE o.user_id = #{query.userId}
				GROUP BY
					of.order_id
			ORDER BY
				o.order_start_time DESC
    </select>
</mapper>
